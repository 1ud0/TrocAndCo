<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
	<title>COMPTE - MES MESSAGES</title>
</h:head>
<h:body bgcolor='white'>

	<ui:composition template="/WEB-INF/templates/templateCompte.xhtml">

		<ui:define name="headPerso">
			<f:metadata>
				<f:event listener="#{mbIdentif.securePage()}" type="preRenderView"></f:event>
			</f:metadata>
		</ui:define>

		<ui:define name="content">

			<div class="introRubrique">
				<p class="lead">Votre messagerie personnelle</p>
				<p class="text-muted">Retrouvez l'ensemble de vos messages et Ã©changez simplement.</p>
			</div>


			<div class="box-body no-padding">
				<div class="mailbox-controls">
					<!-- Check all button -->
					<input type="checkbox" id="checkAll"></input>
					<div class="btn-group">
						<button class="btn btn-default btn-sm">
							<i class="glyphicon glyphicon-trash"></i>
						</button>
					</div>
					<!-- /.btn-group -->
					<button class="btn btn-default btn-sm">
						<i class="glyphicon glyphicon-refresh"></i>
					</button>
					<div class="pull-right">
						1-50/200
						<div class="btn-group">
							<button class="btn btn-default btn-sm">
								<i class="glyphicon glyphicon-arrow-left"></i>
							</button>
							<button class="btn btn-default btn-sm">
								<i class="glyphicon glyphicon-arrow-right"></i>
							</button>
						</div>
						<!-- /.btn-group -->
					</div>
					<!-- /.pull-right -->
				</div>
				<hr></hr>
				<div class="table-responsive mailbox-messages">
					<table class="table table-hover">
						<ui:repeat var="discussion" value="#{mbMessage.LesVraiesDiscussions()}">
						<h:form id="formConversation">
							<tr  class="#{mbMessage.dernierMessage(discussion).lu or mbMessage.dernierMessage(discussion).emetteur.idMembre==mbIdentif.membreConnected.idMembre ? 'lu' : '' }">
								<td><input type="checkbox"></input></td>
								<td class="mailbox-star"><i
										class="fa fa-envelope"></i></td>
								<td class="mailbox-name">
								<h:commandLink value="#{mbMessage.avecQui(discussion)}" onclick="$('#sidebar_secondary').addClass('popup-box-on')">
									<f:ajax event="click" listener="#{mbMessage.loadChat(discussion)}" render="fenetreChat"/>
								</h:commandLink>
								</td>
								<td class="mailbox-subject"><b>#{discussion.proposition.intitule}</b> -   #{mbMessage.debutDernierMessage(discussion)} </td>
								<td class="mailbox-attachment"></td>
								<td class="mailbox-date">#{mbMessage.depuisQuand(discussion)}</td>
							</tr>
							</h:form>
						</ui:repeat>


					</table>
					<!-- /.table -->
				</div>
				<!-- /.mail-box-messages -->
			</div>
			<!-- /.box-body -->






			<!-- *** DEBUT DU CHAT *** _________________________________________________________ -->


			<aside id="sidebar_secondary"
				class="tabbed_sidebar ng-scope chat_sidebar">
				<h:form id="fenetreChat">
				<div class="popup-head">
					<div class="popup-head-left pull-left">
						<a target="_blank" href="shop-detail.html"> <img
							class="md-user-image md-object" alt="objet echange" title=""
							src="#{mbMessage.propAvecPhotos(mbMessage.chat.get(0).proposition.idProposition).photos.get(0).url}"></img>
							<h1>#{mbMessage.chat.get(0).proposition.intitule}</h1></a>
					</div>
					<div class="pull-right">
						<button data-widget="remove" id="removeClass" onclick="document.getElementById('fenetreChat:boutonCache').click()"
							class="chat-header-button pull-right" type="button">	
							<i class="glyphicon glyphicon-remove"></i>
						</button>
						<h:button id="boutonCache" value="close" onclick="$('#sidebar_secondary').removeClass('popup-box-on')" style="display:none">
									
						</h:button>
					</div>
				</div>

				<div id="chat"
					class="chat_box_wrapper chat_box_small chat_box_active"
					style="opacity: 1; display: block; transform: translateX(0px);">
					<div class="chat_box touchscroll chat_box_colors_a">
					<ui:repeat var="message" value="#{mbMessage.chat}" varStatus="loop">
					
						<div class="#{message.emetteur.idMembre!=mbIdentif.membreConnected.idMembre ? 'chat_message_wrapper' : 'chat_message_wrapper chat_message_right'}">
							
							<div class="chat_user_avatar">
								 <img alt=""
									src="#{message.emetteur.avatar}"
									class="md-user-image"></img>
							</div>
					
							<ul class="chat_message">
								<li>
									<p>#{message.texte}
									<span class="chat_message_time">
										<h:outputText value="#{message.dateEnvoi}" >
											<f:convertDateTime pattern="dd/MM/yy hh:mm" timeZone="Europe/Paris" />
										</h:outputText>
									</span></p>
								</li>
								
							</ul>
						</div>

					
						</ui:repeat>
						
					</div>
				</div>
				<div class="chat_submit_box">
					<h:inputText value="#{mbMessage.messageAEnvoyer}" styleClass="md-input">
						
					</h:inputText>
					<h:commandLink action="#{mbMessage.envoyerMessage()}" value="" >
						<i class="fa fa-send"></i>
					</h:commandLink>
					
				</div>

			</h:form>
			</aside>





			<!-- Check/Uncheck toutes les checkbox -->
			<script type="text/javascript">
				$("#checkAll").click(
						function() {
							$('input:checkbox').not(this).prop('checked',
									this.checked);
						});
			</script>


		</ui:define>
	</ui:composition>
</h:body>
</html>
